"use strict";function bindEvents(n){var r=n.attr("index"),t=new Resize(n,{Max:!0,mxContainer:"#poster"}),i;t.Set($(".rRightDown",n),"right-down");t.Set($(".rLeftDown",n),"left-down");t.Set($(".rRightUp",n),"right-up");t.Set($(".rLeftUp",n),"left-up");t.Set($(".rRight",n),"right");t.Set($(".rLeft",n),"left");t.Set($(".rUp",n),"up");t.Set($(".rDown",n),"down");t.Scale=!0;i=n.attr("type");(i=="nickname"||i=="img"||i=="title"||i=="marketprice"||i=="productprice"||i=="thumb")&&(t.Scale=!1);new Drag(n,{Limit:!0,mxContainer:"#poster"});$(".drag .remove").unbind("click").click(function(){$(this).parent().remove()});$.contextMenu({selector:".drag[index="+r+"]",callback:function(n){var t=parseInt($(this).attr("zindex")),i,r,o,u,f,e;if(n=="next")i=$(this).next(".drag"),i.length>0&&i.insertBefore($(this));else if(n=="prev")r=$(this).prev(".drag"),r.length>0&&$(this).insertBefore(r);else if(n=="last"){if(o=$(".drag").length,t>=o-1)return;u=$("#poster .drag:last");u.length>0&&$(this).insertAfter(u)}else if(n=="first"){if(t=$(this).index(),t<=1)return;f=$("#poster .drag:first");f.length>0&&$(this).insertBefore(f)}else n=="delete"&&$(this).remove();e=1;$(".drag").each(function(){$(this).css("z-index",e);e++})},items:{next:{name:"调整到上层"},prev:{name:"调整到下层"},last:{name:"调整到最顶层"},first:{name:"调整到最低层"},"delete":{name:"删除元素"}}});n.unbind("click").click(function(){bind($(this))})}function bindType(n){$("#goodsparams").hide();$(".type4").hide();n=="4"?$(".type4").show():n=="商品"&&$("#goodsparams").show()}function clearTimers(){clearInterval(imgsettimer);clearInterval(nametimer);clearInterval(bgtimer)}function getImgUrl(n){return n.indexOf("http://")==-1&&(n="/attachment/"+n),n}function bind(n){var f=$("#imgset"),r=$("#nameset"),s=$("#qrset"),t,e,o;if(f.hide(),r.hide(),s.hide(),clearTimers(),t=n.attr("type"),t=="img"||t=="thumb"){f.show();var u=n.attr("src"),i=f.find("input"),l=f.find("img");typeof u!="undefined"&&u!=""&&(i.val(u),l.attr("src",getImgUrl(u)));imgsettimer=setInterval(function(){if(i.val()!=u&&i.val()!=""){var t=getImgUrl(i.val());n.attr("src",i.val()).find("img").attr("src",t)}},10)}else if(t=="nickname"||t=="title"||t=="marketprice"||t=="productprice"){r.show();var c=n.attr("color")||"#000",e=n.attr("size")||"16",i=r.find("input:first"),h=r.find("#namesize"),a=r.find(".sp-preview-inner");i.val(c);h.val(e.replace("px",""));a.css({"background-color":c,"font-size":e});nametimer=setInterval(function(){n.attr("color",i.val()).find(".text").css("color",i.val());n.attr("size",h.val()+"px").find(".text").css("font-size",h.val()+"px")},10)}else t=="qr"&&(s.show(),e=n.attr("size")||"3",o=s.find("#qrsize"),o.val(e),o.unbind("change").change(function(){n.attr("size",o.val())}))}$("form").submit(function(){var n=[];return $(".drag").each(function(){var t=$(this),i=t.attr("type"),u=t.css("left"),f=t.css("top"),r={left:u,top:f,type:t.attr("type"),width:t.css("width"),height:t.css("height")};i=="nickname"||i=="title"||i=="marketprice"||i=="productprice"?(r.size=t.attr("size"),r.color=t.attr("color")):i=="qr"?r.size=t.attr("size"):i=="img"&&(r.src=t.attr("src"));n.push(r)}),$(":input[name=Data]").val(JSON.stringify(n)),!0});var imgsettimer=0,nametimer=0,bgtimer=0;$(function(){$(":radio[name=Type]").click(function(){var n=$(this).val();bindType(n)});$("#bgset").find("button:first").click(function(){var n=$(":input[name=BGUrl]").val();bgtimer=setInterval(function(){var t=$(":input[name=BGUrl]").val(),i,r;n!=t&&(t=getImgUrl(t),$("#poster .bg").remove(),i=$("<img src='"+t+"' class='bg' />"),r=$("#poster .drag:first"),r.length>0?i.insertBefore(r):$("#poster").append(i),n=t)},10)});$(".btn-com").click(function(){var u=$("#imgset"),f=$("#nameset"),e=$("#qrset"),n,t,i,r;u.hide();f.hide();e.hide();clearTimers();$("#poster img").length<=0;n=$(this).data("type");t="";n=="qr"?t='<img src="/images/qr.jpg" />':n=="head"?t='<img src="/images/head.jpg" />':n=="img"||n=="thumb"?t='<img src="/images/img.jpg" />':n=="nickname"?t="<div class=text>昵称<\/div>":n=="title"?t="<div class=text>商品名称<\/div>":n=="marketprice"?t="<div class=text>商品现价<\/div>":n=="productprice"&&(t="<div class=text>商品原价<\/div>");i=$("#poster .drag").length+1;r=$('<div class="drag" type="'+n+'" index="'+i+'" style="z-index:'+i+'">'+t+'<div class="rRightDown"> <\/div><div class="rLeftDown"> <\/div><div class="rRightUp"> <\/div><div class="rLeftUp"> <\/div><div class="rRight"> <\/div><div class="rLeft"> <\/div><div class="rUp"> <\/div><div class="rDown"><\/div><\/div>');$("#poster").append(r);bindEvents(r)});$(".drag").click(function(){bindEvents($(this))})});